<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Generative Art</title>
  <!-- Include p5.js library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      touch-action: none;
    }
    canvas {
      display: block;
    }
    /* UI Styling */
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(255, 255, 255, 0.9);
      padding: 10px;
      border-radius: 5px;
      max-height: 90vh;
      overflow-y: auto;
    }
    .button {
      padding: 5px 10px;
      margin: 5px 5px 5px 0;
      background: rgba(200, 200, 200, 0.8);
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }
    .slider-container {
      margin: 5px 0;
    }
    .slider-label {
      font-size: 12px;
      display: block;
    }
    .slider {
      width: 150px;
    }
    .toggle-container {
      display: flex;
      align-items: center;
      margin: 5px 0;
    }
    .toggle-label {
      font-size: 12px;
      margin-left: 5px;
    }
  </style>
</head>
<body>

  <!-- UI Controls -->
  <div id="controls">
    <div>
      <button class="button" onclick="setBrush('base')">Base Brush</button>
      <button class="button" onclick="setBrush('sticker')">Sticker Tool</button>
      <button class="button" onclick="setBrush('paintBucket')">Paint Bucket</button>
      <button class="button" onclick="setBrush('eraser')">Eraser</button>
      <button class="button" onclick="clearCanvas()">Clear Canvas</button>
      <button class="button" onclick="saveCanvasArt()">Save Art</button>
    </div>

    <!-- Hue Slider -->
    <div class="slider-container">
      <label class="slider-label">Hue: <span id="hueValue">0</span></label>
      <input type="range" id="hueSlider" class="slider" min="0" max="360" value="0" oninput="updateParameter('hue')">
      <div class="toggle-container">
        <input type="checkbox" id="hueRandomToggle" onchange="toggleRandomness('hue')">
        <label class="toggle-label" for="hueRandomToggle">Random Hue</label>
      </div>
      <div id="hueRandomnessContainer" style="display: none;">
        <label class="slider-label">Hue Randomness: <span id="hueRandomnessValue">0</span></label>
        <input type="range" id="hueRandomnessSlider" class="slider" min="0" max="180" value="0" oninput="updateRandomness('hue')">
      </div>
    </div>

    <!-- Saturation Slider -->
    <div class="slider-container">
      <label class="slider-label">Saturation: <span id="saturationValue">100</span></label>
      <input type="range" id="saturationSlider" class="slider" min="0" max="100" value="100" oninput="updateParameter('saturation')">
      <div class="toggle-container">
        <input type="checkbox" id="saturationRandomToggle" onchange="toggleRandomness('saturation')">
        <label class="toggle-label" for="saturationRandomToggle">Random Saturation</label>
      </div>
      <div id="saturationRandomnessContainer" style="display: none;">
        <label class="slider-label">Saturation Randomness: <span id="saturationRandomnessValue">0</span></label>
        <input type="range" id="saturationRandomnessSlider" class="slider" min="0" max="100" value="0" oninput="updateRandomness('saturation')">
      </div>
    </div>

    <!-- Brightness Slider -->
    <div class="slider-container">
      <label class="slider-label">Brightness: <span id="brightnessValue">100</span></label>
      <input type="range" id="brightnessSlider" class="slider" min="0" max="100" value="100" oninput="updateParameter('brightness')">
      <div class="toggle-container">
        <input type="checkbox" id="brightnessRandomToggle" onchange="toggleRandomness('brightness')">
        <label class="toggle-label" for="brightnessRandomToggle">Random Brightness</label>
      </div>
      <div id="brightnessRandomnessContainer" style="display: none;">
        <label class="slider-label">Brightness Randomness: <span id="brightnessRandomnessValue">0</span></label>
        <input type="range" id="brightnessRandomnessSlider" class="slider" min="0" max="100" value="0" oninput="updateRandomness('brightness')">
      </div>
    </div>

    <!-- Opacity Slider -->
    <div class="slider-container">
      <label class="slider-label">Opacity: <span id="opacityValue">255</span></label>
      <input type="range" id="opacitySlider" class="slider" min="0" max="255" value="255" oninput="updateParameter('opacity')">
      <div class="toggle-container">
        <input type="checkbox" id="opacityRandomToggle" onchange="toggleRandomness('opacity')">
        <label class="toggle-label" for="opacityRandomToggle">Random Opacity</label>
      </div>
      <div id="opacityRandomnessContainer" style="display: none;">
        <label class="slider-label">Opacity Randomness: <span id="opacityRandomnessValue">0</span></label>
        <input type="range" id="opacityRandomnessSlider" class="slider" min="0" max="255" value="0" oninput="updateRandomness('opacity')">
      </div>
    </div>

    <!-- Stroke Weight Slider -->
    <div class="slider-container">
      <label class="slider-label">Stroke Weight: <span id="strokeWeightValue">5</span></label>
      <input type="range" id="strokeWeightSlider" class="slider" min="1" max="50" value="5" oninput="updateParameter('strokeWeight')">
      <div class="toggle-container">
        <input type="checkbox" id="strokeWeightRandomToggle" onchange="toggleRandomness('strokeWeight')">
        <label class="toggle-label" for="strokeWeightRandomToggle">Random Stroke Weight</label>
      </div>
      <div id="strokeWeightRandomnessContainer" style="display: none;">
        <label class="slider-label">Stroke Weight Randomness: <span id="strokeWeightRandomnessValue">0</span></label>
        <input type="range" id="strokeWeightRandomnessSlider" class="slider" min="0" max="50" value="0" oninput="updateRandomness('strokeWeight')">
      </div>
    </div>

    <!-- Spread Slider -->
    <div class="slider-container">
      <label class="slider-label">Spread: <span id="spreadValue">1</span></label>
      <input type="range" id="spreadSlider" class="slider" min="1" max="50" value="1" oninput="updateParameter('spread')">
      <div class="toggle-container">
        <input type="checkbox" id="spreadRandomToggle" onchange="toggleRandomness('spread')">
        <label class="toggle-label" for="spreadRandomToggle">Random Spread</label>
      </div>
      <div id="spreadRandomnessContainer" style="display: none;">
        <label class="slider-label">Spread Randomness: <span id="spreadRandomnessValue">0</span></label>
        <input type="range" id="spreadRandomnessSlider" class="slider" min="0" max="50" value="0" oninput="updateRandomness('spread')">
      </div>
    </div>

  </div>

  <script>
    let currentBrush = 'base';
    let previousX = null;
    let previousY = null;

    // Parameters
    let parameters = {
      hue: 0,
      saturation: 100,
      brightness: 100,
      opacity: 255,
      strokeWeight: 5,
      spread: 1
    };

    // Randomness Toggles and Amounts
    let randomness = {
      hue: { enabled: false, amount: 0 },
      saturation: { enabled: false, amount: 0 },
      brightness: { enabled: false, amount: 0 },
      opacity: { enabled: false, amount: 0 },
      strokeWeight: { enabled: false, amount: 0 },
      spread: { enabled: false, amount: 0 }
    };

    function setup() {
      createCanvas(windowWidth, windowHeight);
      background(0);
      colorMode(HSB, 360, 100, 100, 255);

      // Initialize parameter values from sliders
      updateAllParameters();
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
      background(0);
    }

    function draw() {
      // No continuous drawing required
    }

    function touchStarted() {
      if (isMouseOverControls()) {
        return false;
      }

      let x = mouseX;
      let y = mouseY;

      if (currentBrush === 'sticker') {
        stickerTool(x, y);
      } else if (currentBrush === 'paintBucket') {
        paintBucketTool(x, y);
      }

      return false;
    }

    function touchMoved() {
      if (isMouseOverControls()) {
        return false;
      }

      let x = mouseX;
      let y = mouseY;

      if (previousX === null || previousY === null) {
        previousX = x;
        previousY = y;
      }

      if (currentBrush === 'base') {
        baseBrush(previousX, previousY, x, y);
      } else if (currentBrush === 'sticker') {
        stickerTool(x, y);
      } else if (currentBrush === 'eraser') {
        eraserTool(previousX, previousY, x, y);
      }

      previousX = x;
      previousY = y;

      return false;
    }

    function touchEnded() {
      previousX = null;
      previousY = null;
    }

    function setBrush(brush) {
      currentBrush = brush;
    }

    function clearCanvas() {
      background(0);
    }

    function saveCanvasArt() {
      saveCanvas('myArt', 'png');
    }

    // Update Parameters
    function updateParameter(param) {
      let value = document.getElementById(param + 'Slider').value;
      parameters[param] = parseFloat(value);
      document.getElementById(param + 'Value').textContent = value;
    }

    // Update all parameters at startup
    function updateAllParameters() {
      let params = ['hue', 'saturation', 'brightness', 'opacity', 'strokeWeight', 'spread'];
      for (let param of params) {
        updateParameter(param);
      }
    }

    // Toggle Randomness
    function toggleRandomness(param) {
      let enabled = document.getElementById(param + 'RandomToggle').checked;
      randomness[param].enabled = enabled;
      document.getElementById(param + 'RandomnessContainer').style.display = enabled ? 'block' : 'none';
    }

    // Update Randomness Amount
    function updateRandomness(param) {
      let value = document.getElementById(param + 'RandomnessSlider').value;
      randomness[param].amount = parseFloat(value);
      document.getElementById(param + 'RandomnessValue').textContent = value;
    }

    // Brush Implementations
    function baseBrush(x1, y1, x2, y2) {
      let hue = getRandomizedValue('hue', parameters.hue, 0, 360);
      let saturation = getRandomizedValue('saturation', parameters.saturation, 0, 100);
      let brightness = getRandomizedValue('brightness', parameters.brightness, 0, 100);
      let opacity = getRandomizedValue('opacity', parameters.opacity, 0, 255);
      let strokeW = getRandomizedValue('strokeWeight', parameters.strokeWeight, 1, 50);
      let spread = getRandomizedValue('spread', parameters.spread, 1, 50);

      stroke(hue, saturation, brightness, opacity);
      strokeWeight(strokeW);

      if (spread > 1) {
        for (let i = 0; i < spread; i++) {
          let offsetX = random(-spread, spread);
          let offsetY = random(-spread, spread);
          line(x1 + offsetX, y1 + offsetY, x2 + offsetX, y2 + offsetY);
        }
      } else {
        line(x1, y1, x2, y2);
      }
    }

    function stickerTool(x, y) {
      let hue = getRandomizedValue('hue', parameters.hue, 0, 360);
      let saturation = getRandomizedValue('saturation', parameters.saturation, 0, 100);
      let brightness = getRandomizedValue('brightness', parameters.brightness, 0, 100);
      let opacity = getRandomizedValue('opacity', parameters.opacity, 0, 255);
      let size = getRandomizedValue('strokeWeight', parameters.strokeWeight * 5, 10, 200);

      let shapes = ['circle', 'square', 'triangle', 'star'];
      let shape = random(shapes);

      fill(hue, saturation, brightness, opacity);
      noStroke();
      push();
      translate(x, y);
      rotate(random(TWO_PI));
      if (shape === 'circle') {
        ellipse(0, 0, size, size);
      } else if (shape === 'square') {
        rectMode(CENTER);
        rect(0, 0, size, size);
      } else if (shape === 'triangle') {
        triangle(
          -size / 2, size / 2,
          size / 2, size / 2,
          0, -size / 2
        );
      } else if (shape === 'star') {
        star(0, 0, size / 2, size, 5);
      }
      pop();
    }

    function eraserTool(x1, y1, x2, y2) {
      stroke(0);
      strokeWeight(parameters.strokeWeight * 2);
      line(x1, y1, x2, y2);
    }

    function paintBucketTool(x, y) {
      loadPixels();
      let d = pixelDensity();
      let w = width * d;
      let h = height * d;
      let startX = floor(x * d);
      let startY = floor(y * d);
      let index = 4 * (startX + startY * w);
      let targetColor = [
        pixels[index],
        pixels[index + 1],
        pixels[index + 2],
        pixels[index + 3]
      ];
      let hue = getRandomizedValue('hue', parameters.hue, 0, 360);
      let saturation = getRandomizedValue('saturation', parameters.saturation, 0, 100);
      let brightness = getRandomizedValue('brightness', parameters.brightness, 0, 100);
      let opacity = getRandomizedValue('opacity', parameters.opacity, 0, 255);
      let replacementColor = color(hue, saturation, brightness, opacity);
      let replacementColorArray = replacementColor.levels;

      if (colorsMatch(targetColor, replacementColorArray)) {
        return;
      }

      floodFill(startX, startY, targetColor, replacementColorArray, w, h);
      updatePixels();
    }

    function floodFill(x, y, targetColor, replacementColor, w, h) {
      let stack = [[x, y]];
      while (stack.length > 0) {
        let [currentX, currentY] = stack.pop();
        let index = 4 * (currentX + currentY * w);
        let currentColor = [
          pixels[index],
          pixels[index + 1],
          pixels[index + 2],
          pixels[index + 3]
        ];

        if (colorsMatch(currentColor, targetColor)) {
          pixels[index] = replacementColor[0];
          pixels[index + 1] = replacementColor[1];
          pixels[index + 2] = replacementColor[2];
          pixels[index + 3] = replacementColor[3];

          if (currentX + 1 < w) stack.push([currentX + 1, currentY]);
          if (currentX - 1 >= 0) stack.push([currentX - 1, currentY]);
          if (currentY + 1 < h) stack.push([currentX, currentY + 1]);
          if (currentY - 1 >= 0) stack.push([currentX, currentY - 1]);
        }
      }
    }

    function colorsMatch(a, b) {
      return a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3];
    }

    // Utility Functions
    function getRandomizedValue(param, baseValue, min, max) {
      if (randomness[param].enabled) {
        let randAmount = randomness[param].amount;
        return constrain(baseValue + random(-randAmount, randAmount), min, max);
      } else {
        return baseValue;
      }
    }

    function isMouseOverControls() {
      let controlsRect = document.getElementById('controls').getBoundingClientRect();
      return mouseX >= controlsRect.left && mouseX <= controlsRect.right &&
             mouseY >= controlsRect.top && mouseY <= controlsRect.bottom;
    }

    function star(x, y, radius1, radius2, npoints) {
      let angle = TWO_PI / npoints;
      let halfAngle = angle / 2.0;
      beginShape();
      for (let a = 0; a < TWO_PI; a += angle) {
        let sx = x + cos(a) * radius2;
        let sy = y + sin(a) * radius2;
        vertex(sx, sy);
        sx = x + cos(a + halfAngle) * radius1;
        sy = y + sin(a + halfAngle) * radius1;
        vertex(sx, sy);
      }
      endShape(CLOSE);
    }

    // Prevent scrolling on mobile
    document.addEventListener('touchmove', function(e) {
      e.preventDefault();
    }, { passive: false });
  </script>

</body>
</html>
