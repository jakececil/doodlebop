<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Generative Art</title>
  <!-- Include p5.js library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      touch-action: none;
    }
    canvas {
      display: block;
    }
    /* UI Styling */
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(255, 255, 255, 0.9);
      padding: 10px;
      border-radius: 5px;
    }
    .button {
      padding: 5px 10px;
      margin: 5px;
      background: rgba(200, 200, 200, 0.8);
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }
    .slider-container {
      margin: 5px 0;
    }
    .slider-label {
      font-size: 12px;
      display: block;
    }
    .slider {
      width: 150px;
    }
  </style>
</head>
<body>

  <!-- UI Controls -->
  <div id="controls">
    <div>
      <button class="button" onclick="setBrush('sizeChanging')">Size Changing Brush</button>
      <button class="button" onclick="setBrush('colorChanging')">Color Changing Brush</button>
      <button class="button" onclick="setBrush('filling')">Filling Brush</button>
      <button class="button" onclick="setBrush('spray')">Spray Brush</button>
      <button class="button" onclick="setBrush('sticker')">Sticker Tool</button>
      <button class="button" onclick="setBrush('eraser')">Eraser</button>
      <button class="button" onclick="clearCanvas()">Clear Canvas</button>
      <button class="button" onclick="muddleCanvas()">Muddle Canvas</button>
    </div>
    <div class="slider-container">
      <label class="slider-label">Randomness: <span id="randomnessValue">50</span></label>
      <input type="range" id="randomnessSlider" class="slider" min="0" max="100" value="50" oninput="updateRandomnessValue()">
    </div>
    <div class="slider-container">
      <label class="slider-label">Scale: <span id="scaleValue">1</span></label>
      <input type="range" id="scaleSlider" class="slider" min="0.1" max="10" step="0.1" value="1" oninput="updateScaleValue()">
    </div>
    <div class="slider-container">
      <label class="slider-label">Color Saturation: <span id="saturationValue">100</span></label>
      <input type="range" id="saturationSlider" class="slider" min="0" max="100" value="100" oninput="updateSaturationValue()">
    </div>
    <div class="slider-container">
      <label class="slider-label">Opacity: <span id="opacityValue">255</span></label>
      <input type="range" id="opacitySlider" class="slider" min="0" max="255" value="255" oninput="updateOpacityValue()">
    </div>
  </div>

  <script>
    let currentBrush = 'sizeChanging';
    let previousX = null;
    let previousY = null;
    let scale = 1;
    let opacity = 255;
    let randomness = 50;
    let saturation = 100;

    let colorHue = 0;
    let colorChangeRate = 1;

    function setup() {
      createCanvas(windowWidth, windowHeight);
      background(0);
      colorMode(HSB, 360, 100, 100, 255);
      strokeWeight(2);
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
      background(0);
    }

    function draw() {
      // No continuous drawing required
    }

    function touchMoved() {
      // Prevent drawing under the controls
      if (isMouseOverControls()) {
        return false;
      }

      let x = mouseX;
      let y = mouseY;

      if (previousX === null || previousY === null) {
        previousX = x;
        previousY = y;
      }

      if (currentBrush === 'sizeChanging') {
        sizeChangingBrush(previousX, previousY, x, y);
      } else if (currentBrush === 'colorChanging') {
        colorChangingBrush(previousX, previousY, x, y);
      } else if (currentBrush === 'filling') {
        fillingBrush(previousX, previousY, x, y);
      } else if (currentBrush === 'spray') {
        sprayBrush(x, y);
      } else if (currentBrush === 'sticker') {
        stickerBrush(x, y);
      } else if (currentBrush === 'eraser') {
        eraserBrush(x, y);
      }

      previousX = x;
      previousY = y;

      return false; // Prevent default behavior
    }

    function touchEnded() {
      previousX = null;
      previousY = null;
    }

    function setBrush(brush) {
      currentBrush = brush;
    }

    function clearCanvas() {
      background(0);
    }

    function muddleCanvas() {
      loadPixels();
      let d = pixelDensity();
      let totalPixels = 4 * (width * d) * (height * d);
      for (let i = 0; i < totalPixels; i += 4) {
        let rand = floor(random(-randomness, randomness)) * 4;
        let newIndex = i + rand;
        if (newIndex >= 0 && newIndex < totalPixels) {
          pixels[i] = pixels[newIndex];
          pixels[i + 1] = pixels[newIndex + 1];
          pixels[i + 2] = pixels[newIndex + 2];
          pixels[i + 3] = pixels[newIndex + 3];
        }
      }
      updatePixels();
    }

    function updateRandomnessValue() {
      randomness = document.getElementById('randomnessSlider').value;
      document.getElementById('randomnessValue').textContent = randomness;
    }

    function updateScaleValue() {
      scale = document.getElementById('scaleSlider').value;
      document.getElementById('scaleValue').textContent = scale;
    }

    function updateOpacityValue() {
      opacity = document.getElementById('opacitySlider').value;
      document.getElementById('opacityValue').textContent = opacity;
    }

    function updateSaturationValue() {
      saturation = document.getElementById('saturationSlider').value;
      document.getElementById('saturationValue').textContent = saturation;
    }

    // Brush Implementations
    function sizeChangingBrush(x1, y1, x2, y2) {
      let weight = (sin(frameCount * 0.1) * 5 + 6) * scale; // Regularly changing size
      strokeWeight(weight);
      stroke((colorHue) % 360, saturation, 100, opacity);
      line(x1, y1, x2, y2);
    }

    function colorChangingBrush(x1, y1, x2, y2) {
      // Smoothly change colorHue with random rate
      colorHue = (colorHue + colorChangeRate) % 360;
      colorChangeRate = random(0.5, 5) * (randomness / 100); // Rate influenced by randomness
      stroke(colorHue, saturation, 100, opacity);
      strokeWeight(2 * scale);
      line(x1, y1, x2, y2);
    }

    function fillingBrush(x1, y1, x2, y2) {
      if (previousX !== null && previousY !== null) {
        fill((colorHue) % 360, saturation, 100, opacity);
        noStroke();
        beginShape();
        vertex(previousX, previousY);
        vertex(x1, y1);
        vertex(x2, y2);
        endShape(CLOSE);
      }
    }

    function sprayBrush(x, y) {
      let sprayRadius = 20 * scale;
      let density = 50;
      fill((colorHue) % 360, saturation, 100, opacity);
      noStroke();
      for (let i = 0; i < density; i++) {
        let angle = random(TWO_PI);
        let radius = random(sprayRadius);
        let px = x + cos(angle) * radius;
        let py = y + sin(angle) * radius;
        ellipse(px, py, 1, 1);
      }
    }

    function stickerBrush(x, y) {
      let shapes = ['circle', 'square', 'triangle', 'star'];
      let shape = random(shapes);
      let size = random(10, 50) * scale;
      fill(random(360), saturation, 100, opacity);
      noStroke();
      push();
      translate(x, y);
      rotate(random(TWO_PI));
      if (shape === 'circle') {
        ellipse(0, 0, size, size);
      } else if (shape === 'square') {
        rectMode(CENTER);
        rect(0, 0, size, size);
      } else if (shape === 'triangle') {
        triangle(
          -size / 2, size / 2,
          size / 2, size / 2,
          0, -size / 2
        );
      } else if (shape === 'star') {
        star(0, 0, size / 2, size, 5);
      }
      pop();
    }

    function eraserBrush(x, y) {
      stroke(0);
      strokeWeight(20 * scale);
      line(previousX, previousY, x, y);
    }

    // Utility Functions
    function isMouseOverControls() {
      let controlsRect = document.getElementById('controls').getBoundingClientRect();
      return mouseX >= controlsRect.left && mouseX <= controlsRect.right &&
             mouseY >= controlsRect.top && mouseY <= controlsRect.bottom;
    }

    function star(x, y, radius1, radius2, npoints) {
      let angle = TWO_PI / npoints;
      let halfAngle = angle / 2.0;
      beginShape();
      for (let a = 0; a < TWO_PI; a += angle) {
        let sx = x + cos(a) * radius2;
        let sy = y + sin(a) * radius2;
        vertex(sx, sy);
        sx = x + cos(a + halfAngle) * radius1;
        sy = y + sin(a + halfAngle) * radius1;
        vertex(sx, sy);
      }
      endShape(CLOSE);
    }

    // Prevent scrolling on mobile
    document.addEventListener('touchmove', function(e) {
      e.preventDefault();
    }, { passive: false });
  </script>

</body>
</html>
